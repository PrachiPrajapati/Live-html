(function(e){function p(e,t){if({}.hasOwnProperty.call(p.cache,e))return p.cache[e];var n=p.resolve(e);if(!n)throw new Error("Failed to resolve module "+e);var r={id:e,require:p,filename:e,exports:{},loaded:!1,parent:t,children:[]};t&&t.children.push(r);var i=e.slice(0,e.lastIndexOf("/")+1);return p.cache[e]=r.exports,n.call(r.exports,r,r.exports,i,e),r.loaded=!0,p.cache[e]=r.exports}console.log=function(){},p.modules={},p.cache={},p.resolve=function(e){return{}.hasOwnProperty.call(p.modules,e)?p.modules[e]:void 0},p.define=function(e,t){p.modules[e]=t};var t,s=(t="/",{title:"browser",version:"v0.10.26",browser:!0,env:{},argv:[],nextTick:e.setImmediate||function(e){setTimeout(e,0)},cwd:function(){return t},chdir:function(e){t=e}});p.define("/gif.coffee",function(e,t,n,r){function i(e,t){return{}.hasOwnProperty.call(e,t)}var s,o,a,h,l;function f(e){var t,n;for(t in this.running=!1,this.options={},this.frames=[],this.freeWorkers=[],this.activeWorkers=[],this.setOptions(e),o)n=o[t],null!=this.options[t]?this.options[t]:this.options[t]=n}a=p("events",e).EventEmitter,s=p("/browser.coffee",e),function(e,t){function n(){this.constructor=e}for(var r in t)i(t,r)&&(e[r]=t[r]);n.prototype=t.prototype,e.prototype=new n,e.__super__=t.prototype}(f,a),h={delay:500,copy:(o={workerScript:"gif.worker.js",workers:2,repeat:0,background:"#fff",quality:10,width:null,height:null,transparent:null},!1)},f.prototype.setOption=function(e,t){return this.options[e]=t,null==this._canvas||"width"!==e&&"height"!==e?void 0:this._canvas[e]=t},f.prototype.setOptions=function(t){var n,r;return function(e){for(n in t)i(t,n)&&(r=t[n],e.push(this.setOption(n,r)));return e}.call(this,[])},f.prototype.addFrame=function(e,t){var n,r;for(r in null==t&&(t={}),(n={}).transparent=this.options.transparent,h)n[r]=t[r]||h[r];if(null!=this.options.width||this.setOption("width",e.width),null!=this.options.height||this.setOption("height",e.height),"undefined"!=typeof ImageData&&null!=ImageData&&e instanceof ImageData)n.data=e.data;else if("undefined"!=typeof CanvasRenderingContext2D&&null!=CanvasRenderingContext2D&&e instanceof CanvasRenderingContext2D||"undefined"!=typeof WebGLRenderingContext&&null!=WebGLRenderingContext&&e instanceof WebGLRenderingContext)t.copy?n.data=this.getContextData(e):n.context=e;else{if(null==e.childNodes)throw new Error("Invalid image");t.copy?n.data=this.getImageData(e):n.image=e}return this.frames.push(n)},f.prototype.render=function(){var n;if(this.running)throw new Error("Already running");if(null==this.options.width||null==this.options.height)throw new Error("Width and height must be set prior to rendering");this.running=!0,this.nextFrame=0,this.finishedFrames=0,this.imageParts=function(e){for(var t=function(){var e;e=[];for(var t=0;0<=this.frames.length?t<this.frames.length:t>this.frames.length;0<=this.frames.length?++t:--t)e.push(t);return e}.apply(this,arguments),n=0,r=t.length;n<r;++n)t[n],e.push(null);return e}.call(this,[]),n=this.spawnWorkers();for(var e=function(){var e;e=[];for(var t=0;0<=n?t<n:n<t;0<=n?++t:--t)e.push(t);return e}.apply(this,arguments),t=0,r=e.length;t<r;++t)e[t],this.renderNextFrame();return this.emit("start"),this.emit("progress",0)},f.prototype.abort=function(){for(var e;null!=(e=this.activeWorkers.shift());)console.log("killing active worker"),e.terminate();return this.running=!1,this.emit("abort")},f.prototype.spawnWorkers=function(){var n,r;return n=Math.min(this.options.workers,this.frames.length),function(){var e;e=[];for(var t=this.freeWorkers.length;this.freeWorkers.length<=n?t<n:n<t;this.freeWorkers.length<=n?++t:--t)e.push(t);return e}.apply(this,arguments).forEach((r=this,function(e){var t,n;return console.log("spawning worker "+e),(t=new Worker(r.options.workerScript)).onmessage=(n=r,function(e){return n.activeWorkers.splice(n.activeWorkers.indexOf(t),1),n.freeWorkers.push(t),n.frameFinished(e.data)}),r.freeWorkers.push(t)})),n},f.prototype.frameFinished=function(e){return console.log("frame "+e.index+" finished - "+this.activeWorkers.length+" active"),this.finishedFrames++,this.emit("progress",this.finishedFrames/this.frames.length),this.imageParts[e.index]=e,function(e,t){for(var n=0,r=t.length;n<r;++n)if(n in t&&t[n]===e)return 1;return 0}(null,this.imageParts)?this.renderNextFrame():this.finishRendering()},f.prototype.finishRendering=function(){for(var e,t,n,r,i,s,o,a=i=0,h=this.imageParts.length;a<h;++a)i+=((t=this.imageParts[a]).data.length-1)*t.pageSize+t.cursor;i+=t.pageSize-t.cursor,console.log("rendering finished - filesize "+Math.round(i/1e3)+"kb"),e=new Uint8Array(i);for(var l=s=0,f=this.imageParts.length;l<f;++l)for(var p=0,c=(t=this.imageParts[l]).data.length;p<c;++p)o=t.data[p],n=p,e.set(o,s),n===t.data.length-1?s+=t.cursor:s+=t.pageSize;return r=new Blob([e],{type:"image/gif"}),this.emit("finished",r,e)},f.prototype.renderNextFrame=function(){var e,t,n;if(0===this.freeWorkers.length)throw new Error("No free workers");return this.nextFrame>=this.frames.length?void 0:(e=this.frames[this.nextFrame++],n=this.freeWorkers.shift(),t=this.getTask(e),console.log("starting frame "+(t.index+1)+" of "+this.frames.length),this.activeWorkers.push(n),n.postMessage(t))},f.prototype.getContextData=function(e){return e.getImageData(0,0,this.options.width,this.options.height).data},f.prototype.getImageData=function(e){var t;return null!=this._canvas||(this._canvas=document.createElement("canvas"),this._canvas.width=this.options.width,this._canvas.height=this.options.height),(t=this._canvas.getContext("2d")).setFill=this.options.background,t.fillRect(0,0,this.options.width,this.options.height),t.drawImage(e,0,0),this.getContextData(t)},f.prototype.getTask=function(e){var t,n;if(n={index:t=this.frames.indexOf(e),last:t===this.frames.length-1,delay:e.delay,transparent:e.transparent,width:this.options.width,height:this.options.height,quality:this.options.quality,repeat:this.options.repeat,canTransfer:"chrome"===s.name},null!=e.data)n.data=e.data;else if(null!=e.context)n.data=this.getContextData(e.context);else{if(null==e.image)throw new Error("Invalid frame");n.data=this.getImageData(e.image)}return n},l=f,e.exports=l}),p.define("/browser.coffee",function(e,t,n,r){var i,s,o,a,h;a=navigator.userAgent.toLowerCase(),o=navigator.platform.toLowerCase(),s="ie"===(h=a.match(/(opera|ie|firefox|chrome|version)[\s\/:]([\w\d\.]+)?.*?(safari|version[\s\/:]([\w\d\.]+)|$)/)||[null,"unknown",0])[1]&&document.documentMode,(i={name:"version"===h[1]?h[3]:h[1],version:s||parseFloat("opera"===h[1]&&h[4]?h[4]:h[2]),platform:{name:a.match(/ip(?:ad|od|hone)/)?"ios":(a.match(/(?:webos|android)/)||o.match(/mac|win|linux/)||["other"])[0]}})[i.name]=!0,i[i.name+parseInt(i.version,10)]=!0,i.platform[i.platform.name]=!0,e.exports=i}),p.define("events",function(e,t,n,r){s.EventEmitter||(s.EventEmitter=function(){});var i=t.EventEmitter=s.EventEmitter,o="function"==typeof Array.isArray?Array.isArray:function(e){return"[object Array]"===Object.prototype.toString.call(e)};i.prototype.setMaxListeners=function(e){this._events||(this._events={}),this._events.maxListeners=e},i.prototype.emit=function(e){if("error"===e&&(!this._events||!this._events.error||o(this._events.error)&&!this._events.error.length))throw arguments[1]instanceof Error?arguments[1]:new Error("Uncaught, unspecified 'error' event.");if(!this._events)return!1;var t=this._events[e];if(!t)return!1;if("function"!=typeof t){if(o(t)){for(var n=Array.prototype.slice.call(arguments,1),r=t.slice(),i=0,s=r.length;i<s;i++)r[i].apply(this,n);return!0}return!1}switch(arguments.length){case 1:t.call(this);break;case 2:t.call(this,arguments[1]);break;case 3:t.call(this,arguments[1],arguments[2]);break;default:n=Array.prototype.slice.call(arguments,1);t.apply(this,n)}return!0},i.prototype.addListener=function(e,t){if("function"!=typeof t)throw new Error("addListener only takes instances of Function");if(this._events||(this._events={}),this.emit("newListener",e,t),this._events[e])if(o(this._events[e])){var n;if(!this._events[e].warned)(n=void 0!==this._events.maxListeners?this._events.maxListeners:10)&&0<n&&this._events[e].length>n&&(this._events[e].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[e].length),console.trace());this._events[e].push(t)}else this._events[e]=[this._events[e],t];else this._events[e]=t;return this},i.prototype.on=i.prototype.addListener,i.prototype.once=function(t,n){var r=this;return r.on(t,function e(){r.removeListener(t,e),n.apply(this,arguments)}),this},i.prototype.removeListener=function(e,t){if("function"!=typeof t)throw new Error("removeListener only takes instances of Function");if(!this._events||!this._events[e])return this;var n=this._events[e];if(o(n)){var r=n.indexOf(t);if(r<0)return this;n.splice(r,1),0==n.length&&delete this._events[e]}else this._events[e]===t&&delete this._events[e];return this},i.prototype.removeAllListeners=function(e){return e&&this._events&&this._events[e]&&(this._events[e]=null),this},i.prototype.listeners=function(e){return this._events||(this._events={}),this._events[e]||(this._events[e]=[]),o(this._events[e])||(this._events[e]=[this._events[e]]),this._events[e]}}),e.GIF=p("/gif.coffee")}).call(this,this);