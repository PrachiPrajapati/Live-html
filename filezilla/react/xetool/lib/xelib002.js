"use strict";var csvImport=angular.module("ngCsvImport",[]);csvImport.directive("ngCsvImport",function(){return{restrict:"E",transclude:!0,replace:!0,scope:{content:"=?",header:"=?",headerVisible:"=?",separator:"=?",separatorVisible:"=?",result:"=?",encoding:"=?",encodingVisible:"=?",accept:"=?",onFileRead:"&",onFileLoad:"&"},template:'<div><div ng-show="headerVisible"><div class="label">Header</div><input type="checkbox" ng-model="header"></div><div ng-show="encoding && encodingVisible"><div class="label">Encoding</div><span>{{encoding}}</span></div><div ng-show="separator && separatorVisible"><div class="label">Seperator</div><span><input class="separator-input" type="text" ng-change="changeSeparator" ng-model="separator"><span></div><div class="custom-file cursor-pointer"><div class="btn btn-default"><span><translate text-value="Choose File"></translate></span></div><input class="custom-file-input" type="file" accept="{{accept}}"/></div></div>',link:function(r,e){r.separatorVisible=r.separatorVisible||!1,r.headerVisible=r.headerVisible||!1,angular.element(e[0].querySelector(".separator-input")).on("keyup",function(e){if(null!=r.content){var a={csv:r.content,header:r.header,separator:e.target.value,encoding:r.encoding};r.result=n(a),r.$apply()}}),e.on("change",function(e){var a=new FileReader;if(!e.target.files.length)return r.result=null,!1;if(r.filename=e.target.files[0].name,0==i(r.filename,"CSV"))return r.$apply(function(){var e={ext:r.filename.split(".")[1].toUpperCase()};r.onFileLoad(e)}),r.result=null,!1;if(a.onload=function(a){r.$apply(function(){var e={csv:a.target.result.replace(/\r\n|\r/g,"\n"),header:r.header,separator:r.separator};r.content=e.csv,r.result=n(e),r.result.filename=r.filename,r.onFileRead()})},"file"!==e.target.type||null==e.target.files&&null==e.srcElement.files){if(null!=r.content){var t={csv:r.content,header:!r.header,separator:r.separator};r.result=n(t),r.onFileRead()}}else a.readAsText((e.srcElement||e.target).files[0],r.encoding);e.target.value=""});var n=function(e){var a=e.csv.split("\n"),t=[],r=0,n=(a[0].split(e.separator).length,[]);e.header&&(n=a[0].split(e.separator),r=1);for(var i=r;i<a.length;i++){var l={},s=a[i].split(new RegExp(e.separator+'(?![^"]*"(?:(?:[^"]*"){2})*[^"]*$)'));if(e.header)for(var o=0;o<n.length;o++)l[n[o]]=s[o];else for(var p=0;p<s.length;p++)l[p]=s[p];t.push(l)}return t},i=function(e,a){return""!=e&&e.split(".")[1].toUpperCase()==a}}}});